<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>äº¬é˜ªåè¦ªå­éŠåŠ©æ‰‹</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --primary:#007aff;
 --bg:#f2f2f7;
 --card:#fff;
 --danger:#ff3b30;
}

body{
 font-family:-apple-system;
 margin:0;
 background:var(--bg);
 padding-bottom:40px;
}

.header{
 background:linear-gradient(135deg,#007aff,#5856d6);
 color:white;
 padding:25px 15px;
 text-align:center;
 border-bottom-left-radius:20px;
 border-bottom-right-radius:20px;
}

.card{
 background:var(--card);
 margin:15px;
 padding:18px;
 border-radius:18px;
 box-shadow:0 2px 8px rgba(0,0,0,0.05);
}

button{
 padding:8px 14px;
 border:none;
 border-radius:10px;
 background:var(--primary);
 color:white;
 font-weight:600;
}

button.delete{
 background:none;
 color:var(--danger);
}

input{
 width:100%;
 padding:8px;
 margin:5px 0;
 border-radius:8px;
 border:1px solid #ddd;
}

iframe{
 width:100%;
 height:220px;
 border:none;
 border-radius:12px;
 margin-top:10px;
}

.expense-item{
 display:flex;
 justify-content:space-between;
 padding:6px 0;
}

.packing-item{
 display:flex;
 align-items:center;
 padding:8px 0;
}

.checked{
 text-decoration:line-through;
 opacity:0.6;
}
</style>
</head>

<body>

<div class="header">
<h2 id="dayDisplay">ç¬¬1å¤©</h2>
<div id="countdown"></div>
</div>

<div class="card">
<h3 id="dayTitle"></h3>
<div id="schedule"></div>
<iframe id="mapFrame"></iframe>
<br>
<button onclick="changeDay(-1)">â†</button>
<button onclick="changeDay(1)">â†’</button>
</div>

<div class="card">
<h3>â• æ–°å¢æ™¯é»</h3>
<input id="newSpotDay" type="number" min="1" max="6" placeholder="åŠ å…¥ç¬¬å¹¾å¤©">
<input id="newSpotTitle" placeholder="æ™¯é»åç¨±">
<input id="newSpotLoc" placeholder="åœ°åœ–æœå°‹é—œéµå­—">
<button onclick="addSpot()">åŠ å…¥è¡Œç¨‹</button>
</div>

<div class="card">
<h3>ğŸ’° æ—…è²»è¨˜å¸³</h3>
<input id="expenseName" placeholder="é …ç›®">
<input id="expenseAmount" type="number" placeholder="é‡‘é¡(Â¥)">
<button onclick="addExpense()">æ–°å¢</button>
<div id="expenseList"></div>
<canvas id="expenseChart"></canvas>
</div>

<div class="card">
<h3>ğŸ§³ è¡Œææ¸…å–®</h3>
<div id="packingList"></div>
</div>

<script>

/* ===== åŸºæœ¬è¨­å®š ===== */

const CONFIG={
 tripStart:new Date("2026-03-11T00:00:00"),
 tripDays:6,
 defaultSchedule:[
  {day:1,title:"âœˆï¸ å°ç£ â†’ å¤§é˜ª",loc:"Kansai International Airport"},
  {day:2,title:"ğŸ  æµ·éŠé¤¨",loc:"Osaka Kaiyukan Aquarium"},
  {day:3,title:"ğŸš„ å¤§é˜ª â†’ åå¤å±‹",loc:"Nagoya Station"},
  {day:4,title:"ğŸŒ³ å‰åœåŠ›å…¬åœ’",loc:"Ghibli Park"},
  {day:5,title:"ğŸš‚ ç£æµ®éµé“é¤¨",loc:"SCMAGLEV and Railway Park"},
  {day:6,title:"ğŸ¤– æ¨‚é«˜æ¨‚åœ’",loc:"LEGOLAND Japan"}
 ],
 packingItems:["è­·ç…§","æ—¥å¹£","å°å­©å¸¸å‚™è—¥","è¡Œå‹•é›»æº","é›¨å…·"]
};

let currentDay=1;
let userSpots=JSON.parse(localStorage.getItem("userSpots"))||[];
let expenses=JSON.parse(localStorage.getItem("expenses"))||[];
let packingStatus=JSON.parse(localStorage.getItem("packingStatus"))||{};
let chart;

/* ===== åˆå§‹åŒ– ===== */

window.onload=function(){
 initDay();
 updateUI();
 renderPacking();
 updateCountdown();
 setInterval(updateCountdown,60000);
}

/* ===== æ—…ç¨‹å¤©æ•¸ ===== */

function initDay(){
 const now=new Date();
 const diff=now-CONFIG.tripStart;
 const day=Math.floor(diff/(1000*60*60*24))+1;
 if(day>0&&day<=CONFIG.tripDays) currentDay=day;
}

/* ===== è¡Œç¨‹é¡¯ç¤º ===== */

function getSchedule(day){
 return [
  ...CONFIG.defaultSchedule.filter(s=>s.day===day),
  ...userSpots.filter(s=>s.day===day)
 ];
}

function updateUI(){
 document.getElementById("dayDisplay").innerText="ç¬¬ "+currentDay+" å¤©";
 document.getElementById("dayTitle").innerText="Day "+currentDay;

 const spots=getSchedule(currentDay);

 let html="";
 spots.forEach(s=>{
  html+=`${s.title}
  ${s.id?`<button class="delete" onclick="deleteSpot(${s.id})">âœ•</button>`:""}
  <br>`;
 });

 document.getElementById("schedule").innerHTML=html;

 if(spots.length>0){
  document.getElementById("mapFrame").src=
  `https://www.google.com/maps?q=${encodeURIComponent(spots[0].loc)}&z=15&output=embed`;
 }

 renderExpenses();
}

function changeDay(step){
 const newDay=currentDay+step;
 if(newDay>=1&&newDay<=CONFIG.tripDays){
  currentDay=newDay;
  updateUI();
 }
}

/* ===== æ–°å¢æ™¯é» ===== */

function addSpot(){
 const day=parseInt(newSpotDay.value);
 const title=newSpotTitle.value;
 const loc=newSpotLoc.value;
 if(!day||!title||!loc) return;

 userSpots.push({id:Date.now(),day,title,loc});
 localStorage.setItem("userSpots",JSON.stringify(userSpots));

 newSpotDay.value="";
 newSpotTitle.value="";
 newSpotLoc.value="";

 updateUI();
}

function deleteSpot(id){
 userSpots=userSpots.filter(s=>s.id!==id);
 localStorage.setItem("userSpots",JSON.stringify(userSpots));
 updateUI();
}

/* ===== è¨˜å¸³ ===== */

function addExpense(){
 const name=expenseName.value;
 const amount=parseInt(expenseAmount.value);
 if(!name||!amount) return;

 expenses.push({id:Date.now(),day:currentDay,name,amount});
 localStorage.setItem("expenses",JSON.stringify(expenses));

 expenseName.value="";
 expenseAmount.value="";
 renderExpenses();
}

function renderExpenses(){
 const today=expenses.filter(e=>e.day===currentDay);
 let html="";
 let totals=Array(CONFIG.tripDays).fill(0);

 today.forEach(e=>{
  html+=`<div class="expense-item">
  ${e.name} Â¥${e.amount}
  <button class="delete" onclick="deleteExpense(${e.id})">âœ•</button>
  </div>`;
 });

 expenses.forEach(e=>totals[e.day-1]+=e.amount);

 document.getElementById("expenseList").innerHTML=html;
 updateChart(totals);
}

function deleteExpense(id){
 expenses=expenses.filter(e=>e.id!==id);
 localStorage.setItem("expenses",JSON.stringify(expenses));
 renderExpenses();
}

function updateChart(data){
 if(chart) chart.destroy();
 chart=new Chart(document.getElementById("expenseChart"),{
  type:"bar",
  data:{
   labels:["D1","D2","D3","D4","D5","D6"],
   datasets:[{label:"æ¯æ—¥èŠ±è²»(Â¥)",data:data,backgroundColor:"#007aff"}]
  }
 });
}

/* ===== è¡Œææ¸…å–® ===== */

function renderPacking(){
 let html="";
 CONFIG.packingItems.forEach(item=>{
  const checked=packingStatus[item]?"checked":"";
  html+=`<div class="packing-item ${checked? "checked":""}">
  <input type="checkbox" ${checked} onchange="toggleItem('${item}')">
  ${item}
  </div>`;
 });
 packingList.innerHTML=html;
}

function toggleItem(item){
 packingStatus[item]=!packingStatus[item];
 localStorage.setItem("packingStatus",JSON.stringify(packingStatus));
 renderPacking();
}

/* ===== å€’æ•¸ ===== */

function updateCountdown(){
 const now=new Date();
 const diff=CONFIG.tripStart-now;
 if(diff>0){
  const days=Math.floor(diff/(1000*60*60*24));
  countdown.innerText="âœˆï¸ è·é›¢å‡ºç™¼ "+days+" å¤©";
 }else{
  countdown.innerText="ğŸ‰ æ—…ç¨‹é€²è¡Œä¸­";
 }
}

</script>
</body>
</html>