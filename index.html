<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¦ªå­æ—…éŠç®¡ç† App</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family:-apple-system;
  margin:0;
  background:#f2f2f7;
  text-align:center;
}

.header{
  background:#007aff;
  color:white;
  padding:15px;
  font-size:18px;
}

.card{
  background:white;
  margin:10px;
  padding:15px;
  border-radius:16px;
}

button{
  padding:8px 12px;
  margin:5px;
  border:none;
  border-radius:12px;
  background:#007aff;
  color:white;
}

input{
  padding:6px;
  margin:5px;
}

iframe{
  width:100%;
  height:250px;
  border:none;
  border-radius:12px;
}
</style>
</head>

<body>

<div class="header">
ä»Šå¤©æ˜¯æ—…ç¨‹ç¬¬ <span id="tripDay">1</span> å¤©
</div>

<div class="card">
<h3 id="dayTitle"></h3>
<div id="schedule"></div>
<iframe id="mapFrame"></iframe>
<button onclick="prevDay()">â†</button>
<button onclick="nextDay()">â†’</button>
</div>

<div class="card">
<h3>ğŸ’° è¨˜å¸³</h3>
<input id="expenseName" placeholder="é …ç›®">
<input id="expenseAmount" type="number" placeholder="é‡‘é¡">
<button onclick="addExpense()">æ–°å¢</button>
<div id="expenseList"></div>
<canvas id="expenseChart"></canvas>
</div>

<div class="card">
<h3>ğŸ§³ è¡Œææ¸…å–®</h3>
<div id="packingList"></div>
</div>

<script>
/* ===== è¡Œç¨‹è³‡æ–™ï¼ˆæ²¿ç”¨ä¹‹å‰ç‰ˆæœ¬ï¼‰ ===== */

const tripStart = new Date("2026-03-11T08:00:00");
const tripDays = 6;

const scheduleData = [
  {title:"âœˆï¸ å°ç£ â†’ åå¤å±‹", location:"Chubu Centrair International Airport"},
  {title:"æ¨‚é«˜æ¨‚åœ’", location:"LEGOLAND Japan"},
  {title:"å‰åœåŠ›å…¬åœ’", location:"Ghibli Park Aichi"},
  {title:"åå¤å±‹åŸ + æ¦®å•†åœˆ", location:"Nagoya Castle"},
  {title:"æ–°å¹¹ç·š â†’ å¤§é˜ª", location:"Shin-Osaka Station"},
  {title:"âœˆï¸ é—œè¥¿æ©Ÿå ´å›å°ç£", location:"Kansai International Airport"}
];

/* ===== æ—…ç¨‹å¤©æ•¸ ===== */

function calculateTripDay(){
  const now = new Date();
  const diff = now - tripStart;
  const day = Math.floor(diff/(1000*60*60*24))+1;
  if(day>0 && day<=tripDays){return day;}
  return 1;
}

let currentDay = calculateTripDay();
updateDay();

function updateDay(){
  document.getElementById("tripDay").innerText=currentDay;
  document.getElementById("dayTitle").innerText="Day "+currentDay;
  document.getElementById("schedule").innerText=scheduleData[currentDay-1].title;

  document.getElementById("mapFrame").src =
  "https://www.google.com/maps?q="+
  encodeURIComponent(scheduleData[currentDay-1].location)+"&output=embed";
}

function prevDay(){if(currentDay>1){currentDay--;updateDay();}}
function nextDay(){if(currentDay<tripDays){currentDay++;updateDay();}}

/* ===== è¨˜å¸³åŠŸèƒ½ï¼ˆæ¯æ—¥åˆ†é¡ï¼‰ ===== */

let expenses = JSON.parse(localStorage.getItem("expenses")) || [];

function addExpense(){
  const name=document.getElementById("expenseName").value;
  const amount=parseInt(document.getElementById("expenseAmount").value);
  if(!name||!amount)return;

  expenses.push({day:currentDay,name,amount});
  localStorage.setItem("expenses",JSON.stringify(expenses));

  document.getElementById("expenseName").value="";
  document.getElementById("expenseAmount").value="";

  renderExpenses();
}

function renderExpenses(){
  let html="";
  let dailyTotals=Array(tripDays).fill(0);

  expenses.forEach(e=>{
    html+=`Day${e.day} ${e.name} - ${e.amount}å…ƒ<br>`;
    dailyTotals[e.day-1]+=e.amount;
  });

  document.getElementById("expenseList").innerHTML=html;
  updateChart(dailyTotals);
}

let chart;
function updateChart(data){
  if(chart)chart.destroy();

  chart=new Chart(document.getElementById("expenseChart"),{
    type:"bar",
    data:{
      labels:["D1","D2","D3","D4","D5","D6"],
      datasets:[{
        label:"æ¯æ—¥èŠ±è²»",
        data:data
      }]
    }
  });
}

renderExpenses();

/* ===== è¡Œææ¸…å–® ===== */

const packingItems=[
  "è­·ç…§","æ©Ÿç¥¨","å°å­©å¤–å¥—","å……é›»å™¨","è¡Œå‹•é›»æº","é›¨å…·"
];

let packingStatus=JSON.parse(localStorage.getItem("packingStatus"))||{};

function renderPacking(){
  let html="";
  packingItems.forEach(item=>{
    const checked=packingStatus[item]?"checked":"";
    html+=`<label>
    <input type="checkbox" onchange="toggleItem('${item}')" ${checked}>
    ${item}
    </label><br>`;
  });
  document.getElementById("packingList").innerHTML=html;
}

function toggleItem(item){
  packingStatus[item]=!packingStatus[item];
  localStorage.setItem("packingStatus",JSON.stringify(packingStatus));
}

renderPacking();

</script>

</body>
</html>