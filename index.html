<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº¬é˜ªåè¦ªå­éŠåŠ©æ‰‹</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #007aff;
            --bg: #f2f2f7;
            --card-bg: #ffffff;
            --text: #1c1c1e;
            --gray: #8e8e93;
            --danger: #ff3b30;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            background: var(--bg);
            color: var(--text);
            padding-bottom: 30px;
        }

        .header {
            background: linear-gradient(135deg, #007aff, #5856d6);
            color: white;
            padding: 25px 15px;
            text-align: center;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .header h1 { margin: 0; font-size: 22px; }
        .header p { margin: 5px 0 0; opacity: 0.8; font-size: 14px; }

        .card {
            background: var(--card-bg);
            margin: 15px;
            padding: 20px;
            border-radius: 18px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        h3 { margin-top: 0; display: flex; align-items: center; gap: 8px; }

        #dayTitle { color: var(--primary); font-size: 1.2rem; }
        #schedule { font-weight: bold; margin: 10px 0; font-size: 1.1rem; min-height: 1.5em; }
        
        iframe {
            width: 100%;
            height: 200px;
            border: none;
            border-radius: 12px;
            margin-top: 10px;
            background: #eee;
        }

        .nav-btns { display: flex; justify-content: space-between; margin-top: 15px; }

        input {
            width: calc(50% - 22px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        button {
            padding: 10px 18px;
            border: none;
            border-radius: 10px;
            background: var(--primary);
            color: white;
            font-weight: 600;
            transition: opacity 0.2s;
        }
        button:active { opacity: 0.7; }
        button.secondary { background: #e5e5ea; color: var(--text); }
        button.delete { background: none; color: var(--danger); padding: 4px 8px; }

        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f2f2f7;
        }

        .packing-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            cursor: pointer;
        }
        .packing-item input { width: auto; margin-right: 12px; }
        .checked { text-decoration: line-through; color: var(--gray); }

        canvas { margin-top: 20px; }
    </style>
</head>
<body>

<div class="header">
    <h1 id="dayDisplay">ç¬¬ 1 å¤©</h1>
    <p>2026 é˜ªåè¦ªå­å†’éšªä¹‹æ—…</p>
</div>

<div class="card">
    <h3 id="dayTitle">Day 1 (3æœˆ11æ—¥)</h3>
    <div id="schedule">è¼‰å…¥ä¸­...</div>
    <iframe id="mapFrame" src=""></iframe>
    <div class="nav-btns">
        <button class="secondary" onclick="changeDay(-1)">â† ä¸Šä¸€å¤©</button>
        <button onclick="changeDay(1)">ä¸‹ä¸€å¤© â†’</button>
    </div>
</div>

<div class="card">
    <h3>ğŸ’° æ—…è²»è¨˜å¸³ (JPY åŒ¯ç‡: 0.21)</h3>
    <div style="display: flex; flex-wrap: wrap; gap: 5px;">
        <input id="expenseName" placeholder="é …ç›®å…§å®¹">
        <input id="expenseAmount" type="number" placeholder="æ—¥å¹£é‡‘é¡(Â¥)">
        <button style="width: 100%;" onclick="addExpense()">æ–°å¢æ¶ˆè²»ç´€éŒ„</button>
    </div>
    
    <div id="expenseList" style="margin-top: 15px; font-size: 14px;"></div>
    <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">
    <canvas id="expenseChart"></canvas>
</div>

<div class="card">
    <h3>ğŸ§³ å¿…å‚™ç‰©è³‡ç¢ºèª</h3>
    <div id="packingList"></div>
</div>

<script>
/* ===== è¨­å®šå€ï¼šæ­£ç¢ºè¡Œç¨‹èˆ‡æ™‚é–“ ===== */
const CONFIG = {
    tripStart: new Date("2026-03-11T00:00:00"), // ç¢ºä¿æ™‚é–“å¾ç•¶å¤©é›¶é»é–‹å§‹
    tripDays: 6,
    jpyRate: 0.21,
    schedule: [
        {title:"âœˆï¸ å°ç£ â†’ å¤§é˜ª (é—œè¥¿åœ‹éš›æ©Ÿå ´)", loc:"Kansai International Airport"},
        {title:"ğŸ  æµ·éŠé¤¨ + ğŸ¡ å¤©ä¿å±±å¤§æ‘©å¤©è¼ª", loc:"Osaka Kaiyukan Aquarium"},
        {title:"ğŸš„ å¤§é˜ª â†’ åå¤å±‹ (ç§»å‹•æ—¥)", loc:"Nagoya Station"},
        {title:"ğŸŒ³ å‰åœåŠ›å…¬åœ’ (å®®å´é§¿ä¸–ç•Œ)", loc:"Ghibli Park"},
        {title:"ğŸš‚ ç£æµ®éµé“é¤¨ + ğŸ›ï¸ å¤§é ˆå•†åº—è¡—", loc:"SCMAGLEV and Railway Park"},
        {title:"ğŸ¤– æ¨‚é«˜æ¨‚åœ’ â†’ âœˆï¸ ä¸­éƒ¨æ©Ÿå ´å›å°", loc:"LEGOLAND Japan"}
    ],
    packingItems: ["è­·ç…§/æ©Ÿç¥¨ç¢ºèª", "æ—¥å¹£ç¾é‡‘/ä¿¡ç”¨å¡", "å°å­©å¸¸å‚™è—¥", "è¡Œå‹•é›»æº", "å°¿å¸ƒ/æ¿•ç´™å·¾", "é›¨å…·/ä¿æš–å¤–å¥—"]
};

let currentDay = 1;
let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
let packingStatus = JSON.parse(localStorage.getItem("packingStatus")) || {};
let chartInstance = null;

/* ===== æ ¸å¿ƒåŠŸèƒ½ ===== */

window.onload = () => {
    initDay();
    updateUI();
    renderPacking();
};

function initDay() {
    const now = new Date();
    // è¨ˆç®—èˆ‡å‡ºç™¼æ—¥æœŸçš„å¤©æ•¸å·®
    const diffTime = now - CONFIG.tripStart;
    const day = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
    currentDay = (day > 0 && day <= CONFIG.tripDays) ? day : 1;
}

function updateUI() {
    const data = CONFIG.schedule[currentDay - 1];
    
    // æ­£ç¢ºè¨ˆç®—é¡¯ç¤ºæ—¥æœŸ
    const displayDate = new Date(CONFIG.tripStart);
    displayDate.setDate(CONFIG.tripStart.getDate() + (currentDay - 1));
    const month = displayDate.getMonth() + 1;
    const date = displayDate.getDate();

    document.getElementById("dayDisplay").innerText = `ç¬¬ ${currentDay} å¤©`;
    document.getElementById("dayTitle").innerText = `Day ${currentDay} (${month}æœˆ${date}æ—¥)`;
    document.getElementById("schedule").innerText = data.title;
    
    // æ›´æ–°åœ°åœ–
    const mapQuery = encodeURIComponent(data.loc);
    document.getElementById("mapFrame").src = `https://maps.google.com/maps?q=${mapQuery}&output=embed`;

    renderExpenses();
}

function changeDay(step) {
    const newDay = currentDay + step;
    if (newDay >= 1 && newDay <= CONFIG.tripDays) {
        currentDay = newDay;
        updateUI();
    }
}

/* ===== è¨˜å¸³åŠŸèƒ½ ===== */

function addExpense() {
    const name = document.getElementById("expenseName").value;
    const amount = parseInt(document.getElementById("expenseAmount").value);
    
    if (!name || isNaN(amount)) return;

    expenses.push({
        id: Date.now(),
        day: currentDay,
        name,
        amount
    });

    saveAndRenderExpenses();
    document.getElementById("expenseName").value = "";
    document.getElementById("expenseAmount").value = "";
}

function deleteExpense(id) {
    expenses = expenses.filter(e => e.id !== id);
    saveAndRenderExpenses();
}

function saveAndRenderExpenses() {
    localStorage.setItem("expenses", JSON.stringify(expenses));
    renderExpenses();
}

function renderExpenses() {
    const listEl = document.getElementById("expenseList");
    let html = "";
    let totals = Array(CONFIG.tripDays).fill(0);

    const todayExpenses = expenses.filter(e => e.day === currentDay);
    
    if (todayExpenses.length === 0) {
        html = `<div style="color:#999; text-align:center;">ä»Šæ—¥å°šç„¡èŠ±è²»</div>`;
    } else {
        todayExpenses.forEach(e => {
            const twd = Math.round(e.amount * CONFIG.jpyRate);
            html += `
                <div class="expense-item">
                    <span>${e.name} (Â¥${e.amount.toLocaleString()})</span>
                    <span>
                        <b style="color:#2c3e50">â‰ˆ NT$${twd}</b>
                        <button class="delete" onclick="deleteExpense(${e.id})">âœ•</button>
                    </span>
                </div>`;
        });
    }
    
    listEl.innerHTML = html;

    expenses.forEach(e => {
        if(e.day <= CONFIG.tripDays) totals[e.day-1] += e.amount;
    });
    updateChart(totals);
}

function updateChart(data) {
    const ctx = document.getElementById("expenseChart").getContext("2d");
    if (chartInstance) chartInstance.destroy();

    chartInstance = new Chart(ctx, {
        type: "bar",
        data: {
            labels: Array.from({length: CONFIG.tripDays}, (_, i) => `D${i+1}`),
            datasets: [{
                label: "æ¯æ—¥æ”¯å‡º (JPY)",
                data: data,
                backgroundColor: "#007aff",
                borderRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: { y: { beginAtZero: true } }
        }
    });
}

/* ===== è¡Œææ¸…å–® ===== */

function renderPacking() {
    const container = document.getElementById("packingList");
    container.innerHTML = CONFIG.packingItems.map(item => {
        const isChecked = packingStatus[item];
        return `
            <div class="packing-item ${isChecked ? 'checked' : ''}" onclick="toggleItem('${item}')">
                <input type="checkbox" ${isChecked ? 'checked' : ''}>
                <span>${item}</span>
            </div>
        `;
    }).join("");
}

function toggleItem(item) {
    packingStatus[item] = !packingStatus[item];
    localStorage.setItem("packingStatus", JSON.stringify(packingStatus));
    renderPacking();
}

</script>

</body>
</html>