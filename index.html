<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº¬é˜ªåè¦ªå­éŠå°èˆªåŠ©æ‰‹ V3</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #007aff;
            --bg: #f2f2f7;
            --card-bg: #ffffff;
            --text: #1c1c1e;
            --gray: #8e8e93;
            --accent: #34c759;
            --danger: #ff3b30;
            --warning: #ff9500;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            background: var(--bg);
            color: var(--text);
            padding-bottom: 40px;
        }

        .header {
            background: linear-gradient(135deg, #007aff, #5856d6);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .card {
            background: var(--card-bg);
            margin: 12px;
            padding: 18px;
            border-radius: 18px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        h3 { margin-top: 0; color: var(--primary); font-size: 1.1rem; border-left: 4px solid var(--primary); padding-left: 10px; }

        /* è¡Œç¨‹æ¸…å–® */
        .schedule-list { text-align: left; padding: 0; list-style: none; }
        .schedule-item {
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 8px;
            background: #f8f8fa;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: 0.2s;
        }
        .schedule-item.active { border-color: var(--primary); background: #f0f7ff; }
        .schedule-time { font-size: 0.75rem; color: var(--primary); font-weight: bold; min-width: 45px; margin-top: 3px; }
        .schedule-icon { font-size: 1.2rem; }
        .schedule-text { font-size: 0.95rem; font-weight: 600; flex: 1; }
        .schedule-sub { font-size: 0.8rem; color: var(--gray); margin-top: 2px; font-weight: normal; line-height: 1.3; }
        
        /* æé†’æ¨™ç±¤ */
        .badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; margin-top: 4px; font-weight: bold; }
        .badge-ticket { background: #e1f5fe; color: #0288d1; border: 1px solid #0288d1; }
        .badge-tip { background: #fff3e0; color: #ef6c00; border: 1px solid #ef6c00; }

        /* åœ°åœ–å€åŸŸ */
        .map-container { width: 100%; height: 230px; margin-bottom: 15px; }
        iframe { width: 100%; height: 100%; border: none; border-radius: 14px; background: #eee; }

        .nav-btns { display: flex; justify-content: space-between; margin-top: 15px; gap: 10px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 12px; background: var(--primary); color: white; font-weight: 600; }
        button.secondary { background: #e5e5ea; color: var(--text); }

        /* è¨˜å¸³æ¨£å¼ */
        .expense-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f2f2f7; font-size: 14px;}
        input { padding: 10px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 10px; width: calc(50% - 22px); }
        .packing-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #f9f9f9; cursor: pointer; }
        .checked { text-decoration: line-through; color: var(--gray); }
    </style>
</head>
<body>

<div class="header">
    <h2 id="dayDisplay" style="margin:0">Day 1</h2>
    <div id="dateDisplay" style="font-size:0.9rem; opacity:0.9">3æœˆ11æ—¥</div>
</div>

<div class="card">
    <div class="map-container">
        <iframe id="mapFrame"></iframe>
    </div>
    
    <ul id="scheduleList" class="schedule-list"></ul>
    
    <div class="nav-btns">
        <button class="secondary" onclick="changeDay(-1)">â† ä¸Šä¸€å¤©</button>
        <button onclick="changeDay(1)">ä¸‹ä¸€å¤© â†’</button>
    </div>
</div>

<div class="card">
    <h3>ğŸ§³ å¿…å‚™ç‰©è³‡ç¢ºèª</h3>
    <div id="packingList"></div>
</div>

<div class="card">
    <h3>ğŸ’° æ—…è²»è¨˜å¸³ (JPY: 0.21)</h3>
    <div style="display: flex; gap: 5px;">
        <input id="expenseName" placeholder="é …ç›®å…§å®¹">
        <input id="expenseAmount" type="number" placeholder="æ—¥å¹£ Â¥">
    </div>
    <button style="width: 100%;" onclick="addExpense()">æ–°å¢ç´€éŒ„</button>
    <div id="expenseList" style="margin-top:15px"></div>
    <canvas id="expenseChart" height="150"></canvas>
</div>

<script>
const CONFIG = {
    tripStart: new Date("2026-03-11T00:00:00"),
    tripDays: 6,
    jpyRate: 0.21,
    schedule: [
        {
            date: "3æœˆ11æ—¥",
            items: [
                { time: "06:55", icon: "âœˆï¸", title: "è™èˆª IT284", sub: "é«˜é›„å‡ºç™¼ï¼Œ10:40 æŠµé”é—œè¥¿ KIX", loc: "Kansai International Airport" },
                { time: "14:00", icon: "ğŸ¨", title: "å¤§é˜ªé¾ä»•æŸé£¯åº—", sub: "æ¢…ç”°ç«™ç›´çµï¼ŒHotel Hankyu RESPIRE", loc: "Hotel Hankyu RESPIRE OSAKA" },
                { time: "16:00", icon: "ğŸŒ…", title: "æ¢…ç”°ç©ºä¸­åº­åœ’", sub: "çœ‹å¤•é™½ï¼Œ5æ­²å°å­©ä¹Ÿé©åˆçš„å¤œæ™¯", loc: "Umeda Sky Building" },
                { time: "17:30", icon: "ğŸ›ï¸", title: "å¤§ä¸¸ç™¾è²¨ (13F)", sub: "å¯¶å¯å¤¢ä¸­å¿ƒã€ä»»å¤©å ‚æ——è‰¦åº—", loc: "Daimaru Umeda" },
                { time: "19:00", icon: "ğŸ•¹ï¸", title: "Yodobashi / Grand Front", sub: "ç©å…·ã€æ‰­è›‹ã€å„å¼è¦ªå­å‹å–„é¤å»³", loc: "Yodobashi Camera Multimedia Umeda" }
            ]
        },
        {
            date: "3æœˆ12æ—¥",
            items: [
                { time: "09:20", icon: "ğŸš‡", title: "æ¢…ç”°å‡ºç™¼ (åœ°éµè½‰ä¹˜)", sub: "å¾¡å ‚ç­‹ç·š(æœ¬ç”ºç«™è½‰) -> ä¸­å¤®ç·š(å¤§é˜ªæ¸¯ç«™)", loc: "Osakako Station" },
                { time: "10:00", icon: "ğŸ ", title: "æµ·éŠé¤¨ (é‡é»æ™¯é»)", sub: "å·²è²·é›»å­ç¥¨(10é»æ™‚æ®µ)ã€‚çœ‹é¯¨é¯Šã€è§¸æ‘¸æ± ï¼Œå…¨ç¨‹æœ‰ç„¡éšœç¤™å¡é“", loc: "Osaka Kaiyukan Aquarium", badge: "badge-ticket", badgeText: "ğŸŸï¸ å·²é ç´„ 10:00" },
                { time: "12:30", icon: "ğŸ±", title: "å¤©ä¿å±±è³¼ç‰©ä¸­å¿ƒåˆé¤", sub: "æ¨è–¦ 2F æµªèŠ±ç¾é£Ÿæ©«ä¸(åŒ—æ¥µæ˜Ÿè›‹åŒ…é£¯ã€æœƒæ´¥å±‹ç« é­šç‡’)", loc: "Tempozan Marketplace" },
                { time: "14:00", icon: "ğŸ¡", title: "ä¸‹åˆæ´»å‹• (äºŒé¸ä¸€)", sub: "A:å¤©ä¿å±±æ‘©å¤©è¼ª / B:è§€å…‰èˆ¹è–ç‘ªéº—äºè™Ÿ (æµ·éŠé¤¨å¾Œæ–¹)", loc: "Tempozan Giant Ferris Wheel" },
                { time: "17:00", icon: "ğŸ§¸", title: "å›æ¢…ç”°ï¼šYodobashi 5F", sub: "å·¨å¤§ç©å…·å€(æˆ°é¬¥é™€èºã€Tomica)ã€‚å¤§äººå¯è¼ªæµå» B1 è²·è—¥å¦", loc: "Links Umeda" },
                { time: "18:30", icon: "ğŸœ", title: "æ™šé¤ï¼šæ¢…ç”°å•†åœˆ", sub: "Grand Front æˆ– Yodobashi 8F ç¾é£Ÿè¡— (åº§ä½å¯¬æ•)", loc: "Grand Front Osaka" }
            ]
        },
        {
            date: "3æœˆ13æ—¥",
            items: [
                { time: "10:00", icon: "ğŸš„", title: "å¤§é˜ª â†’ åå¤å±‹", sub: "æ­ä¹˜æ–°å¹¹ç·šå‰å¾€åå¤å±‹ç«™", loc: "Nagoya Station" },
                { time: "14:00", icon: "ğŸ¨", title: "åå¤å±‹é£¯åº— Check-in", sub: "æ”¾ç½®è¡Œæç¨ä½œä¼‘æ¯", loc: "Nagoya Station" }
            ]
        },
        {
            date: "3æœˆ14æ—¥",
            items: [
                { time: "10:00", icon: "ğŸŒ³", title: "å‰åœåŠ›å…¬åœ’", sub: "æ•´æ—¥è¡Œç¨‹ã€‚å®®å´é§¿ä¸–ç•Œå·¡ç¦®", loc: "Ghibli Park" }
            ]
        },
        {
            date: "3æœˆ15æ—¥",
            items: [
                { time: "10:00", icon: "ğŸš‚", title: "ç£æµ®éµé“é¤¨", sub: "å„å¼æ–°å¹¹ç·šå¯¦é«”å±•å‡ºï¼Œå°å­©å¤©å ‚", loc: "SCMAGLEV and Railway Park" },
                { time: "15:00", icon: "ğŸ›ï¸", title: "å¤§é ˆå•†åº—è¡—", sub: "è—¥å¦è£œè²¨ã€ç¾é£Ÿå°åƒ", loc: "Osu Shopping District" }
            ]
        },
        {
            date: "3æœˆ16æ—¥",
            items: [
                { time: "09:30", icon: "ğŸ¤–", title: "åå¤å±‹æ¨‚é«˜æ¨‚åœ’", sub: "å…¨æ—¥éŠç©ï¼Œé©åˆå°æœ‹å‹æœ€å¾Œè¡åˆº", loc: "LEGOLAND Japan" },
                { time: "17:00", icon: "âœˆï¸", title: "ä¸­éƒ¨åœ‹éš›æ©Ÿå ´å›å°", sub: "æº–å‚™æ­æ©Ÿè¿”å›æº«æš–çš„å®¶", loc: "Chubu Centrair International Airport" }
            ]
        }
    ],
    packingItems: ["è­·ç…§/ç°½è­‰", "æ—¥å¹£ç¾é‡‘/å¡ç‰‡", "å°å­©å‚™ç”¨è—¥", "è¡Œå‹•é›»æº", "å°¿å¸ƒ/æ¿•ç´™å·¾", "é›¨å…·/å¤–å¥—"]
};

let currentDay = 1;
let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
let packingStatus = JSON.parse(localStorage.getItem("packingStatus")) || {};
let chartInstance = null;

window.onload = () => {
    initDay();
    updateUI();
    renderPacking();
};

function initDay() {
    const diff = new Date() - CONFIG.tripStart;
    const day = Math.floor(diff / (1000 * 60 * 60 * 24)) + 1;
    currentDay = (day > 0 && day <= CONFIG.tripDays) ? day : 1;
}

function updateUI() {
    const dayData = CONFIG.schedule[currentDay - 1];
    document.getElementById("dayDisplay").innerText = `ç¬¬ ${currentDay} å¤©`;
    document.getElementById("dateDisplay").innerText = dayData.date;
    
    const listEl = document.getElementById("scheduleList");
    listEl.innerHTML = dayData.items.map((item, index) => `
        <li class="schedule-item ${index === 0 ? 'active' : ''}" onclick="setMap('${item.loc}', this)">
            <div class="schedule-time">${item.time}</div>
            <span class="schedule-icon">${item.icon}</span>
            <div class="schedule-text">
                <div>${item.title}</div>
                <div class="schedule-sub">${item.sub}</div>
                ${item.badge ? `<span class="badge ${item.badge}">${item.badgeText}</span>` : ''}
            </div>
        </li>
    `).join("");

    if (dayData.items.length > 0) setMap(dayData.items[0].loc);
    renderExpenses();
}

function setMap(location, element) {
    const searchUrl = `https://maps.google.com/maps?q=${encodeURIComponent(location)}&t=&z=15&ie=UTF8&iwloc=&output=embed`;
    document.getElementById("mapFrame").src = searchUrl;
    if (element) {
        document.querySelectorAll('.schedule-item').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
    }
}

function changeDay(step) {
    const newDay = currentDay + step;
    if (newDay >= 1 && newDay <= CONFIG.tripDays) {
        currentDay = newDay;
        updateUI();
    }
}

/* ===== è¨˜å¸³èˆ‡æ¸…å–® (åŠŸèƒ½åŒå‰ç‰ˆ) ===== */
function addExpense() {
    const name = document.getElementById("expenseName").value;
    const amount = parseInt(document.getElementById("expenseAmount").value);
    if (!name || isNaN(amount)) return;
    expenses.push({ id: Date.now(), day: currentDay, name, amount });
    localStorage.setItem("expenses", JSON.stringify(expenses));
    document.getElementById("expenseName").value = "";
    document.getElementById("expenseAmount").value = "";
    renderExpenses();
}

function deleteExpense(id) {
    expenses = expenses.filter(e => e.id !== id);
    localStorage.setItem("expenses", JSON.stringify(expenses));
    renderExpenses();
}

function renderExpenses() {
    const listEl = document.getElementById("expenseList");
    const todayExpenses = expenses.filter(e => e.day === currentDay);
    listEl.innerHTML = todayExpenses.length === 0 ? `<div style="color:#999;text-align:center;font-size:13px">ä»Šæ—¥å°šç„¡ç´€éŒ„</div>` : 
        todayExpenses.map(e => `
            <div class="expense-item">
                <span>${e.name} (Â¥${e.amount})</span>
                <span><b>NT$${Math.round(e.amount * CONFIG.jpyRate)}</b> 
                <button style="background:none; color:red; border:none; padding:0 5px;" onclick="deleteExpense(${e.id})">âœ•</button></span>
            </div>
        `).join("");
    updateChart();
}

function updateChart() {
    const ctx = document.getElementById("expenseChart").getContext("2d");
    const totals = Array(CONFIG.tripDays).fill(0);
    expenses.forEach(e => { if(e.day <= CONFIG.tripDays) totals[e.day-1] += e.amount; });
    if (chartInstance) chartInstance.destroy();
    chartInstance = new Chart(ctx, {
        type: "bar",
        data: {
            labels: ["D1", "D2", "D3", "D4", "D5", "D6"],
            datasets: [{ label: "æ”¯å‡º(JPY)", data: totals, backgroundColor: "#007aff", borderRadius: 5 }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });
}

function renderPacking() {
    const container = document.getElementById("packingList");
    container.innerHTML = CONFIG.packingItems.map(item => `
        <div class="packing-item ${packingStatus[item] ? 'checked' : ''}" onclick="toggleItem('${item}')">
            <input type="checkbox" ${packingStatus[item] ? 'checked' : ''}>
            <span>${item}</span>
        </div>
    `).join("");
}

function toggleItem(item) {
    packingStatus[item] = !packingStatus[item];
    localStorage.setItem("packingStatus", JSON.stringify(packingStatus));
    renderPacking();
}
</script>

</body>
</html>